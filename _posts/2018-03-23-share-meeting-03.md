---
layout: post
title: "第三次技术分享会记录 分布式---zk及kafka等"
tags: [分布式, 技术分享会, kafka]
comments: true
date: 2018-03-23 22:00:00+08:00
---

##### 分享会日期：2018-03-23
##### 持续时间：17:00-20:30，3个半小时

>新的一年里，想让自己有些改变、有些进步、有些其他方面的尝试，于是在公司面向技术同事组织了分享会，未来很长一段时期，应该都会由我来主持和主讲，因此在此做些记录，记录下成长轨迹。

>顺序可能有点乱，因为都是即兴发挥，脱稿讲解，可能有很多不足之处，希望能包涵。。。。

##### 一. 分布式和集群
1. 分布式和集群的概念，有何区别
2. 公司现有业务中有哪些是分布式业务，哪些是集群业务
3. 为什么要做分布式的业务
4. 做了分布式之后，相对于传统的单服务器业务开发，在dev和ops层面有了哪些变化和挑战
5. 在此，引出CAP理论，并解释其含义和原因

##### 二. 分布式事务
1. 从上一块的内容中，引出了一个很明显的问题，就是在分布式的业务中去保持一些数据和操作的一致性，同时也要保证可用性和分区容忍性，就得有一个很完善的分布式事务的操作机制，能够尽量的去满足上面的几个需求
2. 介绍2PC、3PC的概念，和他们的缺陷
3. 引出在现在大环境中，解决上述问题的主流方案--paxos
4. paxos不多做介绍，各位自己回去了解
5. 由此引出基于paxos开源的分布式协调管理工具--ZooKeeper

##### 三. ZooKeeper
1. zk在公司现有的项目中有哪些实践，解决了哪些问题
2. zk中的主要机制（节点、注册、订阅、watcher等等）
3. 基于zk跑服务的话，应该从哪里入手（服务方通过zk api维护和zk的长连接，注册到指定节点，client方订阅节点变化等等）
4. zk为接下来即将介绍的kafka提供了哪些服务，解决了哪些问题

##### 四. Kafka
1. 公司现有分布式业务中的日志、埋点和客户端行为上报的数据很多，那么该如何统一的入公司的大ES集群
2. 之前公司旧有日志收集方式（rsync）有哪些缺点：延迟和时间分片有关、会有多进程fork成本、会并发堵塞tcp、网络拥堵时进程会拥堵、不好自动化管理、失败后无显性的重试机制、多消费者消费则会复制上述的问题等等。。。
3. 这么多的问题，解决方案如下：大吞吐队列、分布式、可指向队列位置消费、持久化、多订阅端共同消费
4. 如此多的解决方案，本着 “我们能遇到的问题，其他公司肯定也早会遇到相同问题” 的原则，我们在开源项目中定位到了kafka，基本是为分布式日志收集量身而坐的队列系统
5. 我在实际部署过程中遇到的问题以及注意点等等
6. 介绍kafka的几个概念 Topic、Partition、Offset、Producer、Consumer等等，kafka如何基于这几个概念实现了高吞吐、持久化、可水平拓展、可重复消费、订阅的功能，传统队列为什么没有做到这些
7. 介绍队列消费中的三个模式：准确一次、最少一次和最多一次，区别和为什么会有这样的需求
8. 由7的问题引出consumer消费时的一个commit offset的概念，去分别对应7中的三个模式
9. 由8中的一个commit interval的参数去讨探，他的设计概念和之前分享会讲过的什么东西很相似？答案是TCP_DELAY的算法，讨论两种东西之间的相似性和这样设计的好处及会造成的问题

> 这次分享到此为止，下周会继续，主题将是CDN相关的内容